"use strict";const e=require("../../common/vendor.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const o={__name:"ceping",setup(o){const t=new Date,i=e.reactive({goodInfo:{},cepingerId:getApp().globalData.userid,cepingPicture:[],cepingDate:t.toLocaleDateString(),cepingText:"",shenqingId:0,cepingGoodId:0,goodInfo:{goodPicture:[]}});e.onLoad((e=>{i.cepingGoodId=e.shenqingGoodId,i.shenqingId=e.shenqingId})),e.onShow((()=>{n(),console.log(i)}));const n=()=>{e.index.request({url:"http://127.0.0.1:3000/good/getgoodbyid?goodId="+i.cepingGoodId,success(e){for(let o of e.data.data)o.goodPicture=o.goodPicture.split(",");i.goodInfo=e.data.data[0]}})},c=()=>{const o=i.cepingPicture.join(",");e.index.request({url:"http://127.0.0.1:3000/ceping/addceping",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded"},data:{cepingGoodId:i.cepingGoodId,cepingerId:i.cepingerId,cepingPicture:o,cepingDate:i.cepingDate,cepingText:i.cepingText},success(o){0==o.data.status?(e.index.showToast({title:"发布成功"}),setTimeout((()=>{e.index.redirectTo({url:"/pages/home3/home3"})}),1500)):console.log(o)},fail(e){console.log(e)}})},d=()=>{e.index.chooseImage({count:1,success(o){if(o.tempFilePaths.length>0){let t=o.tempFilePaths[0];e.index.showLoading({title:"上传中..",mask:!0}),e.Es.uploadFile({filePath:t,cloudPath:"a.png",onUploadProgress:function(e){console.log(e),Math.round(100*e.loaded/e.total)},success(e){i.cepingPicture.push(e.fileID)},fail(){e.index.showToast({title:"上传失败",icon:"error"}),e.index.hideLoading()},complete(){e.index.hideLoading()}})}}})};return(o,t)=>e.e({a:i.goodInfo.goodPicture[0],b:e.t(i.goodInfo.goodName),c:e.t(i.goodInfo.goodPrice),d:i.cepingText,e:e.o((e=>i.cepingText=e.detail.value)),f:e.f(i.cepingPicture,((o,t,n)=>({a:"48112bf4-0-"+n,b:e.o((e=>(e=>{i.cepingPicture.splice(e,1)})(t)),t),c:o,d:t}))),g:e.p({type:"closeempty",size:"12",color:"#fff"}),h:i.cepingPicture.length<9},i.cepingPicture.length<9?{i:e.p({type:"plus-filled",size:"20",color:"#949494"}),j:e.o(d)}:{},{k:e.o(c)})}};wx.createPage(o);
